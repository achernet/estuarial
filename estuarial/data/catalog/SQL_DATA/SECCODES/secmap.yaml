SQL:
    secmap:
        type: conditional
        conditionals:
            - seccode
            - vencode
            - ventype

        query: >
            SELECT map.seccode, map.ventype, map.vencode, map.rank,
                CASE WHEN map.exchange = 1 THEN 'US'
                     WHEN map.exchange = 2 THEN 'CA'
                     ELSE 'N/A'
                     END AS exchange,
                map.startdate,
                map.enddate,
                a.minrank
             FROM dbo.SecMapX map
             inner join
                (select min(Rank) as minrank, map.ventype, map.seccode, map.exchange
                    from dbo.secmapx map
                    group by map.seccode, map.ventype, map.exchange) a
                ON map.ventype = a.ventype
                AND map.seccode = a.seccode
                AND map.exchange = a.exchange